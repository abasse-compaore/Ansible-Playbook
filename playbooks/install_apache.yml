---
- name: Installation Apache Ubuntu 24.04
  hosts: all
  become: yes

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install Apache
      apt:
        name: apache2
        state: present

    - name: Try to manage service as apache2
      block:
        - name: Start and enable apache2 service
          systemd:
            name: apache2
            state: started
            enabled: yes
          register: service_result
      rescue:
        - name: Debug - Service apache2 failed
          debug:
            msg: "Service apache2 not found, checking alternatives..."

        - name: Check for httpd service name
          shell: |
            systemctl list-unit-files | grep -E "(apache|httpd)" | head -5
          register: service_names
          changed_when: false

        - name: Show found services
          debug:
            var: service_names.stdout

        - name: Restart Apache using init script (fallback)
          shell: |
            sudo /etc/init.d/apache2 start || \
            sudo service apache2 start || \
            echo "Trying alternative methods..."
          changed_when: false

    - name: Verify Apache is running
      uri:
        url: "http://localhost"
        status_code: 200
      register: http_check
      ignore_errors: yes

    - name: Display verification result
      debug:
        msg: "Apache HTTP check: {{ 'SUCCESS' if http_check.status == 200 else 'FAILED' }}"